<link rel="stylesheet" href="https://unpkg.com/flickity@2/dist/flickity.min.css">

<div class="bg-white stories-form">


    <button id="btn-front" class='d-none'>Front</button>
    <button id="btn-back" class='d-none'>Back</button>

    <video class="{{snapshotOk || viewAr?'d-none':''}} {{spinner?'blur-circle':''}}" id="video" autoplay playsInline ></video>
    <div class="{{snapshotOk?'':'d-none'}} {{viewAr?'d-none':''}} {{filter}}" id="output">
        <img id="outputImage" style="display:none;object-fit: cover;height: 100vh;" class="w-100" alt="Img output">
    </div>
<!-- 
    <div class="container-media">
        <div class="canvas-container">
            <canvas class="output_canvas" width="100%" height="100vh">
            </canvas>
        </div>
    </div> -->
    
    <div class="control-panel d-none">
    </div>

    <div class="container-panel {{snapshotOk?'p-0 m-0':''}} {{spinner || viewAr?'d-none':''}}" >
        <table>
            <tr>
                <td class="{{snapshotOk?'':'d-none'}}" (click)="undo()">
                    <svg xmlns="http://www.w3.org/2000/svg" class='mb-4' height="30px" viewBox="0 0 24 24" width="30px" fill="#fff"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"/></svg>
                </td>
                <td (click)="changeCamera()" class="{{snapshotOk?'d-none':''}}">
                    <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24px" viewBox="0 0 24 24" width="24px" fill="#fff">
                        <g>
                            <rect fill="none" height="24" width="24" />
                        </g>
                        <g>
                            <g>
                                <path d="M9,12c0,1.66,1.34,3,3,3s3-1.34,3-3s-1.34-3-3-3S9,10.34,9,12z M13,12c0,0.55-0.45,1-1,1s-1-0.45-1-1s0.45-1,1-1 S13,11.45,13,12z" />
                                <path d="M8,10V8H5.09C6.47,5.61,9.05,4,12,4c3.72,0,6.85,2.56,7.74,6h2.06c-0.93-4.56-4.96-8-9.8-8C8.73,2,5.82,3.58,4,6.01V4H2v6 H8z" />
                                <path d="M16,14v2h2.91c-1.38,2.39-3.96,4-6.91,4c-3.72,0-6.85-2.56-7.74-6H2.2c0.93,4.56,4.96,8,9.8,8c3.27,0,6.18-1.58,8-4.01V20 h2v-6H16z" />
                            </g>
                        </g>
                    </svg>
                </td>
                <td (click)="snapshot()" class="{{snapshotOk?'d-none':''}}">
                    <svg xmlns="http://www.w3.org/2000/svg" height="54px" viewBox="0 0 24 24" width="54px" fill="#fff">
                        <path d="M0 0h24v24H0V0z" fill="none" />
                        <path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z" />
                    </svg>
                </td>
                <td class="{{snapshotOk?'d-none':''}}" (click)="openFile()">
                    <input class='file-input-stories-form'  max-size="20000" hidden type="file" (change)="fileChangeEvent( $event )" multiple="false">

                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#fff">
                        <path d="M0 0h24v24H0V0z" fill="none" />
                        <path d="M20 4v12H8V4h12m0-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8.5 9.67l1.69 2.26 2.48-3.1L19 15H9zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6H2z" />
                    </svg>
                </td>
            </tr>
            <tr>
                <td class="{{snapshotOk?'':'d-none'}} row-photos-swiper-stories-form">
                    <swiper [spaceBetween]="1" effect="fade" [slidesPerView]="cols">               
                        <ng-template swiperSlide *ngFor="let item of items(); let i = index;">
                            <div>
                                <img src="{{file}}" class="rounded cursor-pointer item  {{item}}" (click)="selectItemCarousel(item)" alt='Filters carousel'>                            
                            </div>
                        </ng-template>
                    </swiper>
                </td>
            </tr>
            <tr class="{{snapshotOk?'d-none':''}}">
                <td>Video</td>
                <td>Photo</td>
                <td (click)="getAr()" class='get-ar'>
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#fff">
                        <path d="M0 0h24v24H0V0z" fill="none" />
                        <path d="M16.66 4.52l2.83 2.83-2.83 2.83-2.83-2.83 2.83-2.83M9 5v4H5V5h4m10 10v4h-4v-4h4M9 15v4H5v-4h4m7.66-13.31L11 7.34 16.66 13l5.66-5.66-5.66-5.65zM11 3H3v8h8V3zm10 10h-8v8h8v-8zm-10 0H3v8h8v-8z" />
                    </svg>
                </td>
            </tr>
        </table>
    </div>
    <div class="{{!spinner?'d-none':''}} div-spinner">
        <span *ngIf="spinner" class="spinner-border" ></span>
    </div>


    <!-- =================================================================================================== -->

    <div class="ar {{viewAr?'':'d-none'}}">
        <video muted id="webcam" class="visible"></video>
        <div id="background">
            <svg width="100%" height="100%">
                <defs>
                    <pattern id="pattern-image" x="0" y="0" width="150" height="150" patternUnits="userSpaceOnUse">
                        <image xlink:href="../../../assets/filter/background-motif.png" x="-25" y="-25" height="100" width="100" />
                        <image xlink:href="../../../assets/filter/background-motif.png" x="125" y="-25" height="100" width="100" />
                        <image xlink:href="../../../assets/filter/background-motif.png" x="50" y="0" height="100" width="100" style="transform: translate(25px, 50px) scale(0.5, -0.5);transform-origin: 50px 50px;" />
                        <image xlink:href="../../../assets/filter/background-motif.png" x="-25" y="125" height="100" width="100" />
                        <image xlink:href="../../../assets/filter/background-motif.png" x="125" y="125" height="100" width="100" />
                    </pattern>
                </defs>
                <rect x="0" y="0" width="100%" height="100%" stroke="none" fill="url(#pattern-image)" />
            </svg>
        </div>
        <canvas id="faceCanvas" tabindex="1"></canvas>
        <div id="loader">
            <svg width="102" height="147" xmlns="http://www.w3.org/2000/svg">
                <g transform="translate(2 3)" fill="none" fill-rule="evenodd">
                    <path d="M8.888 15.386a2.7 2.7 0 00-1.21 3.609A2.688 2.688 0 009.9 20.476c.46.033.94-.05 1.377-.272 9.986-4.953 20.62-7.892 31.623-8.722a2.684 2.684 0 10-.415-5.354c-11.69.887-22.99 4.001-33.597 9.258zM63.827 7.656a2.686 2.686 0 00-3.104 2.192 2.684 2.684 0 002.181 3.103l.01.002c2.506.42 5.052.976 7.55 1.619.071.023.142.046.214.059a2.695 2.695 0 003.066-1.975c.382-1.436-.49-2.901-1.926-3.282a101.477 101.477 0 00-7.99-1.718z" fill="#000" />
                    <path d="M89.712 7.918l2.769 1.108c3.001 1.166 4.928 3.878 4.935 6.921l-.017 27.188v2.423c0 .983 0 1.967-.064 2.945a71.461 71.461 0 01-.624 6.789c-.262 1.708-.553 3.4-.936 5.038-3.64 16.61-13.406 31.536-28.005 42.294l-7.095 5.212c-2.01 1.474-4.271 2.46-6.62 3.07-1.055.125-9.055.125-10.054.001-2.357-.61-4.616-1.6-6.634-3.088l-2.262-1.66-4.815-3.556c-.115-.09-.223-.167-.333-.276C11.342 88.468.67 67.805.665 45.54L.653 15.95c.004-3.04 1.925-5.754 4.941-6.946l2.754-1.076c21.487-8.438 45.6-9.863 67.98-4.269a109.44 109.44 0 0113.384 4.258h0z" stroke="#000" stroke-width="5" />
                    <path id="features" d="M35.576 75.508s6.7 3.425 13.606 3.492c6.906.067 13.467-4.437 13.467-4.437M34.096 38.379s-4.867-2.057-10.233-1.303c-5.365.754-8.582 3.947-8.582 3.947M82.947 39.045s-4.437-2.87-9.852-3.06c-5.415-.19-9.137 2.397-9.137 2.397" stroke="#000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" />
                    <circle class="eyes" fill="#000" cx="25" cy="47" r="4" />
                    <circle class="eyes" fill="#000" cx="74" cy="46" r="4" />
                    <text id="loaderMsg" x="15" y="130" width="100" style="fill: black;font-family: monospace;">Loading...</text>
                </g>
            </svg>
        </div>
        <button id="visibilityToggle" class="on" (click)="toggleWebcamVisibility()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="black" width="18px" height="18px">
                <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" />
                <rect x="0" y="10" width="24" height="2" fill="white" class="strikethrough"></rect>
                <rect x="0" y="12" width="24" height="2" fill="black" class="strikethrough"></rect>
            </svg>
        </button>
        <a id="artist" target="_blank" (click)="closeAr()">
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#000000"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"/></svg>
            Back
        </a>
        <div class="carousel"></div>
    </div>
</div>


