<div class="bg-white stories-form">


    <button id="btn-front" class='d-none'>Front</button>
    <button id="btn-back" class='d-none'>Back</button>

    <video class="{{snapshotOk || viewAr?'d-none':''}} {{spinner?'blur-circle':''}}" id="video" autoplay playsInline ></video>
    <div class="{{snapshotOk?'':'d-none'}} {{viewAr?'d-none':''}} {{filter}}" id="output">
        <img id="outputImage" style="display:none;object-fit: cover;height: 100vh;" class="w-100" alt="Img output">
    </div>
<!-- 
    <div class="container-media">
        <div class="canvas-container">
            <canvas class="output_canvas" width="100%" height="100vh">
            </canvas>
        </div>
    </div> -->
    
    <div class="control-panel d-none">
    </div>
    <form  [formGroup]="storiesForm" (submit)="saveStorie()"  #form="ngForm">
        
        <div class="container-panel {{snapshotOk?'p-0 m-0':''}} {{spinner || viewAr?'d-none':''}}" >
            <table>
                <tr>
                    <td class="{{snapshotOk?'':'d-none'}}" (click)="undo()">
                        <a class="artist" target="_blank">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="20px" fill="#ffffff"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"/></svg>
                        </a>
                    </td>
                    <td class="{{snapshotOk?'':'d-none'}}">
                        <a class="artist">
                            <button type="submit" class="bg-none">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="20px" fill="#ffffff">
                                <path d="M0 0h24v24H0V0z" fill="none"/>
                                <path d="M4.01 6.03l7.51 3.22-7.52-1 .01-2.22m7.5 8.72L4 17.97v-2.22l7.51-1M2.01 3L2 10l15 2-15 2 .01 7L23 12 2.01 3z"/></svg>
                            </button>
                        </a>
                    </td>
                    <td (click)="changeCamera()" class="{{snapshotOk?'d-none':''}}">
                        <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24px" viewBox="0 0 24 24" width="20px" fill="#fff">
                            <g>
                                <rect fill="none" height="24" width="24" />
                            </g>
                            <g>
                                <g>
                                    <path d="M9,12c0,1.66,1.34,3,3,3s3-1.34,3-3s-1.34-3-3-3S9,10.34,9,12z M13,12c0,0.55-0.45,1-1,1s-1-0.45-1-1s0.45-1,1-1 S13,11.45,13,12z" />
                                    <path d="M8,10V8H5.09C6.47,5.61,9.05,4,12,4c3.72,0,6.85,2.56,7.74,6h2.06c-0.93-4.56-4.96-8-9.8-8C8.73,2,5.82,3.58,4,6.01V4H2v6 H8z" />
                                    <path d="M16,14v2h2.91c-1.38,2.39-3.96,4-6.91,4c-3.72,0-6.85-2.56-7.74-6H2.2c0.93,4.56,4.96,8,9.8,8c3.27,0,6.18-1.58,8-4.01V20 h2v-6H16z" />
                                </g>
                            </g>
                        </svg>
                    </td>
                    <td (click)="snapshot()" class="{{snapshotOk?'d-none':''}}">
                        <svg xmlns="http://www.w3.org/2000/svg" height="54px" viewBox="0 0 24 24" width="54px" fill="#fff">
                            <path d="M0 0h24v24H0V0z" fill="none" />
                            <path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z" />
                        </svg>
                    </td>
                    <td class="{{snapshotOk?'d-none':''}}" (click)="openFile()">
                        <input class='file-input-stories-form'  max-size="20000" hidden type="file" formControlName="file" (change)="fileChangeEvent( $event )" multiple="false">

                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="20px" fill="#fff">
                            <path d="M0 0h24v24H0V0z" fill="none" />
                            <path d="M20 4v12H8V4h12m0-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8.5 9.67l1.69 2.26 2.48-3.1L19 15H9zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6H2z" />
                        </svg>
                    </td>
                </tr>
                <tr>
                    <td class="{{snapshotOk?'':'d-none'}} row-photos-swiper-stories-form mb-4">
                        <swiper [spaceBetween]="1" effect="fade" [slidesPerView]="cols">               
                            <ng-template swiperSlide *ngFor="let item of items(); let i = index;">
                                <div>
                                    <img src="{{file}}" class="cursor-pointer w-100 item  {{item}}" (click)="selectItemCarousel(item)" alt='Filters carousel'>                            
                                </div>
                            </ng-template>
                        </swiper>
                    </td>
                </tr>
                <tr class="{{snapshotOk?'d-none':''}}">
                    <td></td>
                    <td (click)="getAr()" class='get-ar'>
                        <svg xmlns="http://www.w3.org/2000/svg" height="28px" viewBox="0 0 24 24" width="28px" fill="#fff"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 10v9H4.98V5h9V3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-9h-2zm-2.94-2.06L17 10l.94-2.06L20 7l-2.06-.94L17 4l-.94 2.06L14 7zM12 8l-1.25 2.75L8 12l2.75 1.25L12 16l1.25-2.75L16 12l-2.75-1.25z"/></svg>
                    </td>
                    <td></td>                
                </tr>
            </table>
        </div>
    </form>
    <div class="{{!spinner?'d-none':''}} div-spinner">
        <span *ngIf="spinner" class="spinner-border" ></span>
    </div>


    <!-- =================================================================================================== -->

    <div class="ar {{viewAr?'':'d-none'}}">
        <video muted id="webcam" class="visible"></video>
        <div id="background">
            <svg width="100%" height="100%">
                <defs>
                    <pattern id="pattern-image" x="0" y="0" width="150" height="150" patternUnits="userSpaceOnUse">
                        <image xlink:href="../../../assets/filter/background-motif.png" x="-25" y="-25" height="100" width="100" />
                        <image xlink:href="../../../assets/filter/background-motif.png" x="125" y="-25" height="100" width="100" />
                        <image xlink:href="../../../assets/filter/background-motif.png" x="50" y="0" height="100" width="100" style="transform: translate(25px, 50px) scale(0.5, -0.5);transform-origin: 50px 50px;" />
                        <image xlink:href="../../../assets/filter/background-motif.png" x="-25" y="125" height="100" width="100" />
                        <image xlink:href="../../../assets/filter/background-motif.png" x="125" y="125" height="100" width="100" />
                    </pattern>
                </defs>
                <rect x="0" y="0" width="100%" height="100%" stroke="none" fill="url(#pattern-image)" />
            </svg>
        </div>
        <canvas id="faceCanvas" tabindex="1"></canvas>
        <div id="loader">
            <svg width="102" height="147" xmlns="http://www.w3.org/2000/svg" class='mt-4'>
                <g transform="translate(2 3)" fill="none" fill-rule="evenodd">
                    <text id="loaderMsg" x="15" y="130" width="100" style="fill: black;font-family: monospace;">Loading...</text>
                </g>
            </svg>
        </div>
        <button id="visibilityToggle" class="on {{snapshotOkArGalery?'d-none':''}}" (click)="toggleWebcamVisibility()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="black" width="18px" height="18px">
                <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" />
                <rect x="0" y="10" width="24" height="2" fill="white" class="strikethrough"></rect>
                <rect x="0" y="12" width="24" height="2" fill="black" class="strikethrough"></rect>
            </svg>
        </button>
        <table class="table-panel-footer fixed-bottom mb-3 {{snapshotOkArGalery?'d-none':''}}" >
            <tr>
                <td>
                    <a class="artist" target="_blank" (click)="closeAr()">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="20px" fill="#ffffff"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"/></svg>
                    </a>
                </td>
                <!-- <td>
                    <a class="artist" target="_blank" (click)="photoAr()">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="20px" fill="#ffffff"><path d="M0 0h24v24H0z" fill="none"/><path d="M21 6h-3.17L16 4h-6v2h5.12l1.83 2H21v12H5v-9H3v9c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zM8 14c0 2.76 2.24 5 5 5s5-2.24 5-5-2.24-5-5-5-5 2.24-5 5zm5-3c1.65 0 3 1.35 3 3s-1.35 3-3 3-3-1.35-3-3 1.35-3 3-3zM5 6h3V4H5V1H3v3H0v2h3v3h2z"/></svg>
                    
                    </a>
                </td> -->
                <td>
                    <a class="artist" target="_blank" (click)="photoArGalery()">
                        <input class='file-input-stories-form-ar-galery'  max-size="20000" hidden type="file" (change)="fileChangeEventAr( $event )" multiple="false">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="20px" fill="#ffffff"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M20 4v12H8V4h12m0-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8.5 9.67l1.69 2.26 2.48-3.1L19 15H9zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6H2z"/></svg>
                    </a>
                </td>
            </tr>
        </table>
        <table class="table-panel-footer-ar-cropper w-100 fixed-bottom mb-3 {{snapshotOkArGalery?'':'d-none'}}" >
            <tr>
                <td>
                    <a class="artist" target="_blank" (click)="closeCroppedAr()">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="20px" fill="#ffffff"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"/></svg>
                    </a>
                </td>
                <td>
                    <a class="artist" target="_blank" (click)="confirmeCropped()">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="20px" fill="#ffffff"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg>
                    </a>
                </td>
            </tr>
        </table>

        <!-- Preview Photo new Face at the Galery -->
        <div class="{{snapshotOkArGalery?'':'d-none'}} " id="outputArGalery">
            <img id="outputImageArGalery" style="display:none;object-fit: cover;height: 100vh;" class="w-100" alt="Img output">
        </div>
        <div class="carousel"></div>
        <image-cropper class="preview-photo-crop-form-stories-ar   {{snapshotOkArGalery?'':'d-none'}}"
                        [imageBase64]="imageBase64String"
                        [imageChangedEvent]="imageChangedEvent"
                        [maintainAspectRatio]="false"
                        [aspectRatio]="3/4"
                        (imageCropped)="imageCropped($event)"
        ></image-cropper>
        <!-- END Preview Photo new Face at the Galery -->

        
    </div>
    <div class="row-swiper-facefilter mb-4 {{viewAr?'':'d-none'}} {{snapshotOkArGalery?'d-none':''}}">
        <swiper [spaceBetween]="1" effect="fade" [slidesPerView]="cols">               
            <ng-template swiperSlide *ngFor="let item of itemsFilterFace(); let i = index;">
                <div>
                    <img src="{{item.entry}}" class="w-100 cursor-pointer item " (click)="selectItemCarouselFaceFilter(item,i)" alt='Filters carousel'>                            
                </div>
            </ng-template>
        </swiper>
    </div>
</div>


